name: 每日自动更新

on:
  schedule:
    # 每天北京时间早上1点运行
    - cron: '0 17 * * *'
  
  # 支持手动触发工作流
  workflow_dispatch:

jobs:
  run-and-commit:  # 注意：job ID必须使用英文
    name: 运行并提交  # 这里可以用中文显示名称
    runs-on: ubuntu-latest

    steps:
    # 步骤1：检出代码仓库
    - name: 检出代码
      uses: actions/checkout@v4

    # 步骤2：设置Python环境
    - name: 配置Python环境
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'

    # 步骤3：安装依赖包
    - name: 安装依赖
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt

    # 步骤4：运行主程序
    - name: 执行主程序
      run: |
        python main.py

    # 步骤5：提交变更结果
    - name: 提交变更
      run: |
        git config --global user.name 'github-actions'
        git config --global user.email 'actions@users.noreply.github.com'
        git add .
        git diff-index --quiet HEAD || git commit -m "自动更新工作流运行结果"
        git push
